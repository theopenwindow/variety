
<html>
    <head>
      <title>Jellyfish</title>
<!--       <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script> -->
      <!-- <script src="http://d3js.org/d3.v3.min.js"></script> -->
       <script type="text/javascript" src="js/d3-3.1.0/d3.js"></script>
      <style type="text/css">
          body,html, div {
            height:600px;
          }

          .wrapper {
                 width: 600px;
                 margin: 40px auto 40px auto;
          }
          .axis path,
          .axis line {
          	fill: none;
          	stroke: black;
           	shape-rendering: crispEdges;
         	
          }

          .axis text {
          	font-family: sans-serif;
          	font-size: 11px;
          }


          .tooltip {
                position: absolute;
                z-index: 10;
                opacity:1;
            }

            .tooltip p {
                /*background-color: rgba(211, 219, 222, 0.8 );*/
                /*background-color: rgba(0,0,0,0.1);*/
                background-color: rgba(255,255,255,0.7);
                font-size: 12px;
                border: none;
                border-radius: 3px;
                padding: 5px;
                line-height: 140%;
                color:black;
            }
      </style>
    </head>
    <body>
      <div class="wrapper">
       
       <div id="svg"></div>
      
      </div><!-- wrapper -->
    </body>
    <script type="text/javascript">
            var fullWidth = 800;
            var fullHeight = 700;

            var margin = {top: 15, right: 100, bottom: 80, left: 50};

            var width =  fullWidth - margin.left - margin.right;
            var height = fullHeight - margin.top - margin.bottom;

            // var dotRadius = 6;

            var color = d3.scale.ordinal().range(['#bf4339','#3b4b6f']);

            var xScale = d3.scale.ordinal()
                                 .rangeRoundBands([margin.left, margin.left+width], 1);
            var yScale = d3.scale.linear()
                                 .range([margin.top+height, margin.top]);

            var xAxis = d3.svg.axis()
                              .scale(xScale)
                              .orient("bottom");
                              //.ticks(3);
            var yAxis = d3.svg.axis()
                              .scale(yScale)
                              .orient("left");

            var svg = d3.select("#svg")
                        .append("svg")
                        .attr("width", fullWidth)
                        .attr("height", fullHeight);

            svg.append("svg:image")
              .attr("xlink:href", "img/jellyfish_legend.png")
              .attr("width", "15%")
              .attr("x", "40")
              .attr("y","100");

            d3.csv("data/jellyfish_data45.csv", function(data){

             /* data.sort(function(a, b) {
                return d3.descending(+a.genre, +b.genre);
              });*/

            	xScale.domain(data.map(
                function(d){
            			return d.genre;
            		}));
            	yScale.domain(d3.extent(
            		data, function(d){
            			return + d.score;
            		}));
          

            	var circles = svg.selectAll("circle")
            	                 .data(data)
            	                 .enter()
            	                 .append("circle")
            	                 .attr("class", "dots");


              var circleScale = d3.scale.linear()
                                        .range([2, 50])
                                        .domain([100, 20000])
                                        .domain(d3.extent(data, function(d){
                                          return +d.population;
                                        }));

            	circles.attr("cx", function(d){
            		    return +xScale(d.genre);
            	})
            	       .attr("cy", function(d){
            	       	return +yScale(d.score);
            	       })
            	       .attr("r", function(d){
                      return circleScale(d.population);
                     })
                     .attr("opacity", "0.5")
                     .attr("fill",   function(d,i) { return color(d.originality); });

            	svg.append("g")
            	   .attr("class", "x axis")
            	   .attr("transform", "translate(0, "+(margin.top + height)+ ")")
            	   .call(xAxis);

            	svg.append("g")
            	   .attr("class", "y axis")
            	   .attr("transform", "translate("+ (margin.left)+", 0)")
            	   .call(yAxis);

//x,y axis label:
            	 svg.append("text")
                   .attr("transform", "rotate(-90)")
                   .attr("y", margin.left/8)
                   .attr("x", 0 - fullHeight*0.4)
                   .attr("dy", "1em")
                   .style("text-anchor", "middle")
                   .text("豆瓣评分")
                   .attr("font-family", "sans-serif")
                   .attr("font-size", "80%");

                svg.append("text")
                   .attr("transform", "translate(" + (fullWidth/2-margin.left/2) + ", "+ (fullHeight-margin.bottom/2) + ")")
                   .style("text-anchor", "middle")
                   .text("节目类别")
                   .attr("font-family", "sans-serif")
                   .attr("font-size", "80%");

                circles
                     .on("mouseover", mouseoverFunc) 
                     .on("mousemove", mousemoveFunc)
                     .on("mouseout", mouseoutFunc);

        

              var tooltip = d3.select("#svg")
                         .append("div")
                         .attr("class", "tooltip");

                function mouseoverFunc(d) {
                    d3.select(this)
                        .transition()
                        .attr("opacity", 1)
                        .attr("r",function(d){
                      return circleScale(d.population)+10;
                      })
                        .attr("cursor", "pointer");
                  tooltip.style("display", null) 
                          .html("<p>" + d.name +
                                    "<br>评分: " + d.score +
                                  "<br>评分人数: " + d.population + "<br>"+d.country+"</p>");
                    
                    };


                function mousemoveFunc(d) {
                    tooltip
                        .style("top", (d3.event.pageY) + "px" )
                        .style("left", (d3.event.pageX) + "px");
                    };

                function mouseoutFunc(d) {
                    d3.select(this)
                        .transition()
                        .attr("opacity", 0.5)
                        .attr("r",function(d){
                      return circleScale(d.population);
                      });
                    tooltip.style("display", "none");  
              };



              var country = data.map(function(d){
                                return d.country;
                              });


                 var legend = svg.selectAll(".legend")
                 // .data(country.slice())
              .data(["原创","引进"])
              .enter().append("g")
              .attr("class", "legend")
              .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            legend.append("circle")
              .attr("cx", margin.left+20)
              .attr("cy", margin.top+30)
              // .attr("width", 30)
              .attr("r", 5)
              .style("fill", color)
              .style("opacity", "0.8");

          legend.append("text")
              .attr("x", margin.left+35)
              .attr("y", margin.top+30)
              .attr("dy", "5px")
              // .style("text-anchor", "end")
              .style("font-size", "10px")
              .text(function(d) { return d; });

            });



       </script>
</html>